<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Tr·ª£ l√Ω √¥n thi TN THPT m√¥n Tin h·ªçc</title>

<style>
body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:#f5f7fb;
}

header{
    position:fixed;
    top:0;
    left:0;
    right:0;
    background:#fff;
    padding:14px 24px;
    border-bottom:1px solid #e5e7eb;
    z-index:1000;
}

header strong{
    font-size:18px;
}

header .subtitle{
    font-size:12px;
    color:#666;
}

.container{
    max-width:1100px;
    margin:110px auto 120px;
    padding:0 16px;
}

.search-box{
    display:flex;
    gap:12px;
    margin-bottom:20px;
}

.search-box input{
    flex:1;
    padding:12px;
    border-radius:12px;
    border:1px solid #ddd;
}

.counter{
    background:#eaf1ff;
    color:#2563eb;
    padding:10px 16px;
    border-radius:12px;
    font-weight:bold;
}

.topic{
    background:#fff;
    border-radius:16px;
    margin-bottom:18px;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

.topic-header{
    padding:18px;
    font-weight:bold;
    cursor:pointer;
}

.topic-content{
    padding:18px;
    border-top:1px solid #eee;
}

.grade{
    margin-bottom:18px;
}

.grade-title{
    font-weight:bold;
    margin-bottom:8px;
}

.grade-title button{
    margin-left:10px;
    padding:4px 10px;
    border:none;
    border-radius:8px;
    background:#eaf1ff;
    color:#2563eb;
    cursor:pointer;
}

label{
    display:block;
    margin:6px 0;
    cursor:pointer;
}

.bottom-bar{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:#fff;
    border-top:1px solid #e5e7eb;
    padding:12px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 -2px 8px rgba(0,0,0,0.08);
}

.bottom-info{
    background:#f1f5ff;
    padding:8px 16px;
    border-radius:14px;
}

.start-btn{
    background:#2563eb;
    color:#fff;
    border:none;
    border-radius:14px;
    padding:14px 24px;
    font-weight:bold;
    cursor:pointer;
}

/* STUDY SCREEN */
#studyScreen{
    display:none;
    margin-top:90px;
}

.study-header{
    display:flex;
    gap:12px;
    background:#f1f5f9;
    padding:12px;
    border-radius:16px;
    margin:20px;
}

.tab{
    flex:1;
    padding:14px;
    border:none;
    border-radius:12px;
    background:#fff;
    cursor:pointer;
    font-weight:bold;
    color:#64748b;
}

.tab.active{
    color:#2563eb;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
}

.study-content{
    background:#fff;
    margin:20px;
    padding:24px;
    border-radius:20px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
}

.tab-content{
    display:none;
}

.tab-content.active{
    display:block;
}

.study-content h2{
    margin-top:0;
}

.study-content h3{
    color:#2563eb;
}
</style>
</head>

<body>

<header>
<strong>Tr·ª£ l√Ω √¥n thi TN THPT m√¥n Tin h·ªçc</strong>
<div class="subtitle">√îN THI T·ªêT NGHI·ªÜP</div>
</header>

<div class="container">

<div class="search-box">
<input type="text" placeholder="T√¨m b√†i h·ªçc (Python, Excel, AI...)">
<div class="counter">ƒê√É CH·ªåN <span id="selectedCount">0</span></div>
</div>

<div class="topic">
<div class="topic-header" onclick="toggleTopic(this)">CH·ª¶ ƒê·ªÄ A ‚Äì M√°y t√≠nh v√† x√£ h·ªôi tri th·ª©c</div>
<div class="topic-content">

<div class="grade">
<div class="grade-title">L·ªöP 10 <button onclick="selectAll(this)">T·∫§T C·∫¢</button></div>
<label><input type="checkbox"> D·ªØ li·ªáu, th√¥ng tin v√† x·ª≠ l√Ω th√¥ng tin</label>
<label><input type="checkbox"> L∆∞u tr·ªØ, trao ƒë·ªïi v√† b·∫£o m·∫≠t th√¥ng tin</label>
</div>

<div class="grade">
<div class="grade-title">L·ªöP 12 <button onclick="selectAll(this)">T·∫§T C·∫¢</button></div>
<label><input type="checkbox"> Gi·ªõi thi·ªáu v·ªÅ tr√≠ tu·ªá nh√¢n t·∫°o</label>
<label><input type="checkbox"> ·ª®ng d·ª•ng AI</label>
</div>

</div>
</div>

<div class="topic">
<div class="topic-header" onclick="toggleTopic(this)">CH·ª¶ ƒê·ªÄ F ‚Äì Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ v·ªõi m√°y t√≠nh</div>
<div class="topic-content">

<div class="grade">
<div class="grade-title">L·ªöP 10 <button onclick="selectAll(this)">T·∫§T C·∫¢</button></div>
<label><input type="checkbox"> Python: Bi·∫øn v√† ki·ªÉu d·ªØ li·ªáu</label>
<label><input type="checkbox"> C√¢u l·ªánh l·∫∑p</label>
</div>

<div class="grade">
<div class="grade-title">L·ªöP 12 <button onclick="selectAll(this)">T·∫§T C·∫¢</button></div>
<label><input type="checkbox"> HTML c∆° b·∫£n</label>
<label><input type="checkbox"> CSS c∆° b·∫£n</label>
</div>

</div>
</div>

</div>

<div class="bottom-bar">
<div class="bottom-info">
<strong>L·ªò TR√åNH S·∫¥N S√ÄNG</strong><br>
<span id="bottomCount">0</span> b√†i h·ªçc
</div>
<button class="start-btn" onclick="startStudy()">‚ö° B·∫ÆT ƒê·∫¶U √îN T·∫¨P</button>
</div>

<div id="studyScreen">
<div class="study-header">
<button class="tab active" onclick="switchTab(event,'theory')">üìò L√Ω thuy·∫øt</button>
<button class="tab" onclick="switchTab(event,'practice')">‚úçÔ∏è Luy·ªán t·∫≠p</button>
<button class="tab" onclick="switchTab(event,'advice')">ü§ñ L·ªùi khuy√™n AI</button>
</div>

<div class="study-content">
<div id="theory" class="tab-content active"></div>
<div id="practice" class="tab-content"></div>
<div id="advice" class="tab-content"></div>
</div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxsjtxVm1K_SHkAGNRxeCicjpiSPmedCi9k8SZvqeJoSlu2qMLjAS7_dCOLEa-jEz5uQg/exec";

const checkboxes = document.querySelectorAll('input[type="checkbox"]');
const countSpan = document.getElementById('selectedCount');
const bottomCount = document.getElementById('bottomCount');

function updateCount(){
    let c = 0;
    checkboxes.forEach(cb => cb.checked && c++);
    countSpan.textContent = c;
    bottomCount.textContent = c;
}
checkboxes.forEach(cb => cb.addEventListener('change', updateCount));

function toggleTopic(h){
    const c = h.nextElementSibling;
    c.style.display = c.style.display === "none" ? "block" : "none";
}

function selectAll(btn){
    const boxes = btn.closest('.grade').querySelectorAll('input');
    const allChecked = [...boxes].every(b => b.checked);
    boxes.forEach(b => b.checked = !allChecked);
    updateCount();
}

function startStudy() {
    const list = [];
    document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
        list.push(cb.parentElement.innerText.trim());
    });

    if (list.length === 0) {
        alert("Vui l√≤ng ch·ªçn b√†i h·ªçc!");
        return;
    }

    document.querySelector('.container').style.display = "none";
    document.querySelector('.bottom-bar').style.display = "none";
    document.getElementById('studyScreen').style.display = "block";
    window.scrollTo(0, 0);

    renderTheory(list);
    renderPractice(list);
    renderAdvice();
}

/* ===== FIX L·ªñI ·ªû ƒê√ÇY ===== */
function renderTheory(list) {
    const box = document.getElementById('theory');
    box.innerHTML = "‚è≥ ƒêang t·∫£i l√Ω thuy·∫øt...";

    const url = SCRIPT_URL + "?type=theory&topics=" + encodeURIComponent(list.join(", "));

    fetch(url)
        .then(r => {
            if (!r.ok) throw new Error("M·∫°ng c√≥ v·∫•n ƒë·ªÅ");
            return r.text();
        })
        .then(t => {
            // N·∫øu backend tr·∫£ v·ªÅ text thu·∫ßn t√∫y
            box.innerHTML = "<h2>üìò T√≥m t·∫Øt ki·∫øn th·ª©c</h2>" + t.replace(/\n/g,"<br>");
        })
        .catch(err => {
            box.innerHTML = "‚ùå L·ªói t·∫£i l√Ω thuy·∫øt. Chi ti·∫øt: " + err.message;
            console.error(err);
        });
}

function renderPractice(list) {
    const box = document.getElementById('practice');
    box.innerHTML = "‚è≥ ƒêang t·∫°o c√¢u h·ªèi...";

    fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain" },
        body: JSON.stringify({ type:"practice", topics: list })
    })
    .then(r => r.text())
    .then(t => {
        box.innerHTML = "<h2>‚úçÔ∏è C√¢u h·ªèi luy·ªán t·∫≠p</h2>" + t.replace(/\n/g,"<br>");
    })
    .catch(err => {
        box.innerHTML = "‚ùå L·ªói t·∫£i c√¢u h·ªèi";
        console.error(err);
    });
}

function renderAdvice(){
    document.getElementById('advice').innerHTML =
        "<h2>ü§ñ L·ªùi khuy√™n AI</h2><p>∆Øu ti√™n ch·ªß ƒë·ªÅ F, luy·ªán tr·∫Øc nghi·ªám h·∫±ng ng√†y, ch√∫ √Ω c√¢u h·ªèi b·∫´y.</p>";
}

function switchTab(e,id){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    e.target.classList.add('active');

    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}
</script>

</body>
</html>

